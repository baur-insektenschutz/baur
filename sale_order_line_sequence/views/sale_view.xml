<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_order_form" model="ir.ui.view">
        <field name="name">sale.order.form</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">
            <field name="order_line" position="before">
                <field name="max_line_sequence" invisible="1" />
            </field>
           <!--  <field name="order_line" position="attributes">
                <attribute
                    name="context"
                >{'default_sequence': max_line_sequence}</attribute>
            </field> -->
            <xpath
                expr="//field[@name='order_line']/tree/field[@name='sequence']"
                position="before"
            >
                <button name="action_add_section" string="" icon="fa-level-down" type="object"/>
            </xpath>
            <xpath expr="//field[@name='order_line']//tree//field[@name='product_id']" position="after">
                <field name="order_id" invisible="1"/>
                <field name="section_id" optional="hide" domain="[('display_type', '=', 'line_section'), ('order_id', '=', order_id)]" />
                <field name="sequence2" optional="hide" invisible="display_type in ('line_section', 'line_note')" string="Seqence"/>
            </xpath>
            <xpath expr="//field[@name='order_line']//form//field[@name='display_type']" position="after">
                <field name="create_uid" invisible="1" />
                <label for="sequence2" invisible="not create_uid" string="Sequence"/>
                <field name="sequence2" invisible="not create_uid"/>
                <label for="section_id" string="Section" invisible="display_type == 'line_section'" />
                <field name="section_id" invisible="display_type == 'line_section'" domain="[('display_type', '=', 'line_section'), ('order_id', '=', parent.id)]"/>
            </xpath>
            <xpath expr="//tree//control//create[@name='add_section_control']" position="replace">
            </xpath>
            <xpath expr="//tree//control//create[@name='add_note_control']" position="replace">
            </xpath>
            <xpath expr="//group[@name='note_group']" position="before">
                <button name="action_add_section_btn" string="Add Section" type="object" class="btn btn-primary ms-1 me-1"/>
                <button name="action_add_note_btn" string="Add Note" type="object" class="btn btn-primary ms-1 me-1"/>
            </xpath>
        </field>
    </record>


    <record id="view_sale_add_section" model="ir.ui.view">
        <field name="name">sale.add.section.form</field>
        <field name="model">add.section</field>
        <field name="arch" type="xml">
            <form string="Add Section">
                <group>
                    <group>
                        <field name="display_type" widget="radio" options="{'horizontal': true}" invisible="hide_display_type" />
                        <field name="hide_display_type" invisible="1"/>
                        <field name="product_id" invisible = "display_type in ('section','note')"  required = "display_type == 'product'" />
                        <separator string="Write Section" colspan="4" invisible = "display_type in ('product','note') " required ="display_type == 'section'"/>
                        <field name="section" colspan="2" invisible = "display_type in ('product','note') " required ="display_type == 'section'" nolabel="1"/>
                        <field name="note" invisible = "display_type in ('section','product') " required ="display_type == 'note'"/>
                    </group>
                    <group>
                        <separator string="Section List" colspan="4"/>
                        <field name="md_section_list" colspan="2" widget="many2many_tags" domain="[('display_type', '=', 'line_section'), ('order_id', '=', order_id)]" nolabel="1" readonly="1"/>
                    </group>
                    <group>

                        <field name="seq" invisible="1"/>
                        <field name="order_id" invisible="1"/>
                    </group>
                </group>
                <footer>
                    <button name="add_line" string="Add" type="object" class="btn-primary"/>
                    <button string="Cancel" class="btn-default" special="cancel"/>
                </footer>                    
            </form>
        </field>
    </record>

</odoo>
